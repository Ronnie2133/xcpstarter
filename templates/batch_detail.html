{% extends 'layout.html' %}
{% block content %}
<h2>Batch: {{ b.name }}</h2>
<p class="muted">Yield: {{ '%.2f'|format(b.yield_qty) }} {{ b.yield_unit }}{% if b.notes %} • {{ b.notes }}{% endif %}</p>

<h3>Ingredients</h3>
<table>
  <tr><th>Item</th><th style="text-align:right">Qty</th><th>Unit</th><th style="text-align:right">Ext. Cost</th><th></th></tr>
  {% for ing in b.ingredients %}
    <tr>
      <td>{{ ing.item.name }}</td>
      <td style="text-align:right">{{ '%.3f'|format(ing.qty) }}</td>
      <td>{{ ing.unit }}</td>
      <td style="text-align:right">${{ '%.2f'|format(ing.ext_cost) }}</td>
      <td><a href="{{ url_for('batch_delete_ing', batch_id=b.id, ing_id=ing.id) }}">Remove</a></td>
    </tr>
  {% else %}
    <tr><td colspan="5" class="muted">No ingredients yet. Add some below.</td></tr>
  {% endfor %}
  <tr>
    <td colspan="3" style="text-align:right"><strong>Total</strong></td>
    <td style="text-align:right"><strong>${{ '%.2f'|format(b.total_cost) }}</strong></td>
    <td></td>
  </tr>
</table>

<h3>Add Ingredient</h3>
<form method="post" action="{{ url_for('batch_detail', batch_id=b.id) }}" class="inline">
  <select name="item_id" required>
    {% for i in items %}
      <option value="{{ i.id }}">{{ i.name }} — ${{ '%.2f'|format(i.unit_cost) }}/{{ i.unit }}</option>
    {% endfor %}
  </select>
  <input name="qty" type="number" step="0.01" placeholder="Qty" required>
  <select name="unit" required>
    {% for u in ['g','kg','oz','lb','ml','l'] %}
      <option value="{{u}}">{{u}}</option>
    {% endfor %}
  </select>
  <button type="submit">Add</button>
</form>
{% endblock %}
